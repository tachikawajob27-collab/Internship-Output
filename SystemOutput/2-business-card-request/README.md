# 1-2 名刺作成依頼通知システム（Business Card Request Notifier）

フォームで受け付けた名刺作成依頼を起点に、スプレッドシート上の依頼行を「通知済み」管理しつつ、Slackへ通知する Google Apps Script（GAS）です。  
入力途中の編集にも対応し、必要情報が入力されたタイミングで通知して抜け漏れを防ぐ設計です。

---

## 目的（解決したい課題）
- 名刺作成依頼がフォームに集約されても、担当者が気付かず対応が遅れる
- 手入力・修正が発生すると、通知漏れや重複通知が起きやすい
- 通知の有無をスプレッドシート上で管理できず、運用が属人化しやすい

本システムは「通知の自動化」と「通知済み管理」をセットで実現し、依頼対応の漏れを防止します。

---

## できること
- フォーム送信時に、該当行をSlackへ通知し「通知済み=済」を自動記録
- 手入力や修正（編集）時も、指定した列が更新されたタイミングで未通知ならSlack通知
- 「通知済み」列が存在しない場合は自動で追加
- 既に通知済み（済）の行は、追加編集があっても再通知しない（重複通知防止）
- Webhook等の機密情報は Script Properties で管理（公開リポジトリに含めない）

---

## システムの動作フロー（具体）
### 1) フォーム送信時（onFormSubmit）
1. フォーム回答が対象シートに追加される
2. `onFormSubmit` トリガーで該当行を処理
3. 氏名（キー列）が入力されており、未通知の場合のみSlack通知
4. 通知成功後、「通知済み」列に `済` を記録

### 2) 編集時（onEdit）
1. 対象シートで、指定した列（氏名/役職/電話/メール/住所など）が編集される
2. 未通知（通知済み≠済）かつ、値が新規入力または変更された場合のみ処理
3. 氏名が入力されていればSlack通知し、「通知済み=済」を記録

※公開用の方針として、Slack通知本文には電話番号・メール・住所などの個人情報は含めず、「氏名＋該当行リンク」のみにしています。

---

## シート要件（例）
対象シート（例：`フォームの回答 1`）の1行目に、少なくとも以下のヘッダーが必要です（完全一致）：
- お名前（漢字フルネーム） または お名前（いずれか）
- 役職 / 電話番号 / メールアドレス / 名刺送付先の住所（編集トリガーとして使用）

また、「通知済み」列は無ければスクリプトが自動追加します。

---

## セットアップ
1. スプレッドシートに Apps Script を紐づけ、本コードを配置
2. **インストール型トリガー**を設定
   - `onFormSubmit`：フォーム送信時
   - `onEdit`：編集時
3. Script Properties に Slack Webhook を設定
   - Key：`SLACK_WEBHOOK_URL`
   - Value：Webhook URL（公開リポジトリには含めない）

---

## セキュリティ（公開用方針）
- Webhook URL、スプレッドシートID、社内URL、個人情報をソースに含めない方針です。
- Slack通知に個人情報（電話/メール/住所）を載せない運用としています。
- 詳細はリポジトリの `docs/security.md` を参照してください。
